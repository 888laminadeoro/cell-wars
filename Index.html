<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cell Wars: Hunter Edition</title>
    <style>
        body { margin: 0; background: #050505; color: #fff; font-family: sans-serif; overflow: hidden; touch-action: none; }
        #ui { position: absolute; top: 20px; left: 20px; pointer-events: none; z-index: 10; }
        #mass { font-size: 24px; color: #00d4ff; font-weight: bold; text-shadow: 0 0 10px rgba(0,212,255,0.5); }
        canvas { display: block; }
        #menu { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; }
        .btn { padding: 15px 40px; font-size: 20px; background: #00d4ff; border: none; border-radius: 30px; color: #000; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn:hover { transform: scale(1.1); box-shadow: 0 0 20px #00d4ff; }
    </style>
</head>
<body>
    <div id="ui"><div id="mass">Masa: 10</div></div>
    <div id="menu">
        <h1 style="color:#00d4ff; font-size: 50px;">CELL WARS</h1>
        <button class="btn" onclick="start()">EMPEZAR CAZA</button>
    </div>
    <canvas id="c"></canvas>

    <script>
        const canvas = document.getElementById('c'), ctx = canvas.getContext('2d');
        let w, h, player, foods = [], enemies = [], gameActive = false;
        const WORLD_SIZE = 5000;

        function resize() { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; }
        window.onresize = resize; resize();

        class Entity {
            constructor(x, y, m, c, isBot = false) {
                this.x = x; this.y = y; this.m = m; this.c = c; this.isBot = isBot;
                this.name = isBot ? ["Rex", "Killer", "Alpha", "Shadow", "Zar"][Math.floor(Math.random()*5)] : "TÚ";
            }
            get r() { return Math.sqrt(this.m / Math.PI) * 5; }
            draw(camX, camY, zoom) {
                let sx = (this.x - camX) * zoom + w/2;
                let sy = (this.y - camY) * zoom + h/2;
                let sr = this.r * zoom;
                if (sx < -sr || sx > w + sr || sy < -sr || sy > h + sr) return;
                ctx.beginPath(); ctx.arc(sx, sy, sr, 0, 7);
                ctx.fillStyle = this.c; ctx.shadowBlur = 10 * zoom; ctx.shadowColor = this.c; ctx.fill();
                ctx.shadowBlur = 0; ctx.strokeStyle = "rgba(255,255,255,0.2)"; ctx.stroke();
                ctx.fillStyle = "#fff"; ctx.font = `${12 * zoom}px Arial`; ctx.textAlign = "center";
                ctx.fillText(this.name, sx, sy - sr - 5);
            }
        }

        function start() {
            document.getElementById('menu').style.display = 'none';
            player = new Entity(WORLD_SIZE/2, WORLD_SIZE/2, 15, "#00d4ff");
            foods = []; enemies = []; gameActive = true;
            for(let i=0; i<300; i++) spawnFood();
            for(let i=0; i<20; i++) spawnEnemy(true);
            loop();
        }

        function spawnFood() {
            foods.push({x: Math.random()*WORLD_SIZE, y: Math.random()*WORLD_SIZE, c: `hsl(${Math.random()*360},70%,60%)`});
        }

        function spawnEnemy(anywhere = false) {
            let x, y;
            if (anywhere) { x = Math.random()*WORLD_SIZE; y = Math.random()*WORLD_SIZE; }
            else { // Aparecer cerca del jugador pero fuera de vista
                let ang = Math.random() * Math.PI * 2;
                x = player.x + Math.cos(ang) * 800; y = player.y + Math.sin(ang) * 800;
            }
            enemies.push(new Entity(x, y, 10 + Math.random()*player.m*1.5, `hsl(${Math.random()*360},80%,50%)`, true));
        }

        let mx = w/2, my = h/2;
        canvas.onmousemove = e => { mx = e.clientX; my = e.clientY; };
        canvas.ontouchmove = e => { mx = e.touches[0].clientX; my = e.touches[0].clientY; };

        function loop() {
            if (!gameActive) return;
            ctx.fillStyle = '#050505'; ctx.fillRect(0, 0, w, h);
            
            let zoom = Math.max(0.3, 1 - (player.m / 1000));
            let dx = mx - w/2, dy = my - h/2, dist = Math.sqrt(dx*dx + dy*dy);
            if (dist > 10) {
                let s = Math.max(1, 15 / Math.sqrt(player.m));
                player.x += (dx/dist)*s; player.y += (dy/dist)*s;
            }

            // Grid
            ctx.strokeStyle = '#111'; ctx.beginPath();
            for(let i=0; i<WORLD_SIZE; i+=100) {
                let sx = (i - player.x)*zoom + w/2; ctx.moveTo(sx, 0); ctx.lineTo(sx, h);
                let sy = (i - player.y)*zoom + h/2; ctx.moveTo(0, sy); ctx.lineTo(w, sy);
            } ctx.stroke();

            foods.forEach((f, i) => {
                let d = Math.sqrt((f.x-player.x)**2 + (f.y-player.y)**2);
                if (d < player.r) { player.m += 0.5; foods.splice(i, 1); spawnFood(); }
                let sx = (f.x - player.x)*zoom + w/2, sy = (f.y - player.y)*zoom + h/2;
                ctx.fillStyle = f.c; ctx.beginPath(); ctx.arc(sx, sy, 3*zoom, 0, 7); ctx.fill();
            });

            enemies.forEach((e, i) => {
                let edist = Math.sqrt((player.x-e.x)**2 + (player.y-e.y)**2);
                // Si el enemigo se aleja demasiado (más de 1500px), lo movemos cerca
                if (edist > 2000) { enemies.splice(i, 1); spawnEnemy(); return; }
                
                let es = Math.max(0.5, 10 / Math.sqrt(e.m));
                if (edist < 600) { // IA: Si es más grande, te caza. Si es más pequeño, huye.
                    if (e.m > player.m * 1.1) { e.x += (player.x-e.x)/edist*es; e.y += (player.y-e.y)/edist*es; }
                    else { e.x -= (player.x-e.x)/edist*es; e.y -= (player.y-e.y)/edist*es; }
                }

                if (edist < player.r + e.r) {
                    if (player.m > e.m * 1.1) { player.m += e.m/2; enemies.splice(i, 1); spawnEnemy(); }
                    else if (e.m > player.m * 1.1) { alert("¡DEVORADO!"); location.reload(); }
                }
                e.draw(player.x, player.y, zoom);
            });

            player.draw(player.x, player.y, zoom);
            document.getElementById('mass').innerText = `Masa: ${Math.floor(player.m)}`;
            requestAnimationFrame(loop);
        }
    </script>
</body>
</html>
